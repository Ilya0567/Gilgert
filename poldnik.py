import pandas as pd

class PoldnikGenerator:
    """
    –ö–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–∞–±–ª–∏—Ü–µ–π '–ø–æ–ª–¥–Ω–∏–∫–∏' (poldnik.csv).
    –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ —Å—Ç–æ–ª–±—Ü—ã:
      - –ù–∞–∑–≤–∞–Ω–∏–µ
      - –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –Ω–∞ 1 –ø–æ—Ä—Ü–∏—é:
      - –ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ:
      - –ë–ª—é–¥–æ –∏–∑ (–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è)
      - –ö–∞–∫–æ–µ –±–ª—é–¥–æ (–º–æ–∂–Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –µ—Å–ª–∏ –≤–µ—Å—å —Ñ–∞–π–ª ‚Äî —Ç–æ–ª—å–∫–æ –ø—Ä–æ –ø–æ–ª–¥–Ω–∏–∫–∏)
    """

    def __init__(self, data_source):
        try:
            self.df = pd.read_csv(data_source)
            print("Poldnik DataFrame –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ!")
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ Poldnik DataFrame: {e}")
            self.df = None

        if self.df is None or self.df.empty:
            raise ValueError("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–ª–¥–Ω–∏–∫–∞—Ö.")

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –Ω—É–∂–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫
        needed_cols = ["–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–≤—Ç—Ä–∞–∫–∞:", "–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –Ω–∞ 1 –ø–æ—Ä—Ü–∏—é:", "–ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ:", "–ë–ª—é–¥–æ –∏–∑"]
        for col in needed_cols:
            if col not in self.df.columns:
                raise ValueError(f"–í poldnik.csv –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ '{col}'")

        self.df.columns = self.df.columns.str.strip()

    def get_unique_categories(self):
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –∏–∑ '–ë–ª—é–¥–æ –∏–∑'."""
        return sorted(self.df["–ë–ª—é–¥–æ –∏–∑"].dropna().unique().tolist())

    def get_items_by_category(self, category: str):
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ '–ù–∞–∑–≤–∞–Ω–∏–µ' –±–ª—é–¥, —É –∫–æ—Ç–æ—Ä—ã—Ö '–ë–ª—é–¥–æ –∏–∑' == category."""
        sub_df = self.df[self.df["–ë–ª—é–¥–æ –∏–∑"] == category]
        return sub_df["–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–≤—Ç—Ä–∞–∫–∞:"].tolist()

    def get_item_details(self, item_name: str):
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º, –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞–º–∏ –∏ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ–º."""
        row = self.df[self.df["–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–≤—Ç—Ä–∞–∫–∞:"] == item_name]
        if row.empty:
            return f"–ë–ª—é–¥–æ ¬´{item_name}¬ª –Ω–µ –Ω–∞–π–¥–µ–Ω–æ (–ø–æ–ª–¥–Ω–∏–∫)."

        ingredients = row.iloc[0]["–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –Ω–∞ 1 –ø–æ—Ä—Ü–∏—é:"]
        preparation = row.iloc[0]["–ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ:"]
        return (
            f"üç™ {item_name}\n\n"
            f"–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:\n{ingredients}\n\n"
            f"–ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ:\n{preparation}"
        )
