# Отчет по проекту Telegram-бота для людей с синдромом Жильбера

## 1. Общее описание проекта

Проект представляет собой Telegram-бота, разработанного для помощи людям с синдромом Жильбера. Бот предоставляет широкий функционал поддержки: возможность задавать вопросы через GPT, получать рекомендации по питанию, проверять безопасность продуктов, просматривать рецепты здоровой пищи и проходить опросы о состоянии здоровья.

## 2. Архитектура проекта

### 2.1 Основные компоненты

1. **Telegram Bot Core (`assistant.py`)** - центральный модуль, отвечающий за инициализацию бота, маршрутизацию сообщений и взаимодействие с пользователями.

2. **Web-сервер Flask (`flask_app.py`)** - обеспечивает работу веб-интерфейса для анкетирования пользователей, просмотра статистики и автоматического обновления бота через GitHub webhook.

3. **База данных (SQLAlchemy)** - хранит информацию о пользователях, их взаимодействии с ботом, истории сообщений, результаты опросов и рейтинги рецептов.

4. **Модули обработчиков команд (директория `handlers/`)** - содержат логику для обработки различных сценариев использования бота.

5. **Модули управления питанием (директория `meals/`)** - содержат классы для работы с рецептами разных приемов пищи.

6. **Вспомогательные утилиты (директория `utils/`)** - содержит конфигурацию, интеграцию с GPT-3.5, управление состояниями и обработку данных.

### 2.2 Схема взаимодействия компонентов

```
┌─────────────────┐     ┌───────────────┐     ┌────────────────┐
│   Telegram API  │<───>│  assistant.py  │<───>│ База данных   │
└─────────────────┘     └───────────────┘     └────────────────┘
                             ↑   ↑
                             │   │
                ┌────────────┘   └───────────┐
                │                            │
        ┌───────────────┐            ┌──────────────┐
        │   handlers/   │            │   utils/     │
        │   (модули     │            │  (утилиты,   │
        │ обработчиков) │            │конфигурация) │
        └───────────────┘            └──────────────┘
                ↑                            ↑
                │                            │
        ┌───────────────┐            ┌──────────────┐
        │    meals/     │<──────────>│ flask_app.py │───> Веб-интерфейс
        │  (модули с    │            │ (веб-сервер) │     (анкеты, статистика)
        │   рецептами)  │            └──────────────┘
        └───────────────┘
```

## 3. Функциональные возможности

### 3.1 Основные функции

1. **Общение с ботом через GPT-3.5**
   - Распознавание вопросов о синдроме Жильбера
   - Сохранение истории диалогов
   - Интеллектуальные ответы на пользовательские запросы

2. **Проверка продуктов**
   - Поиск продуктов в базе данных
   - Выдача рекомендаций по безопасности употребления

3. **Рецепты здорового питания**
   - Разделение по категориям (завтраки, обеды, полдники, ужины)
   - Просмотр рецептов с ингредиентами и способом приготовления
   - Система оценки рецептов пользователями

4. **Мониторинг состояния здоровья**
   - Ежедневные напоминания о самочувствии
   - Сбор данных о настроении и состоянии
   - Отслеживание динамики состояния

5. **Анкетирование пользователей**
   - Веб-форма для заполнения подробной анкеты
   - Сохранение результатов в базе данных
   - Напоминания о заполнении анкеты

6. **Административные функции**
   - Рассылка сообщений всем пользователям
   - Просмотр статистики использования бота
   - Обновление контента рецептов

### 3.2 Доступные команды

- **/start** - начало работы с ботом, доступ к основному меню
- **/recipes** - просмотр рецептов здорового питания
- **/stats** - просмотр статистики (для администраторов)
- **/admin** - доступ к административным функциям
- **/broadcast** - отправка сообщений всем пользователям

## 4. Технический стек

1. **Python 3.x** - основной язык программирования
2. **python-telegram-bot** - библиотека для взаимодействия с Telegram API
3. **SQLAlchemy** - ORM для работы с базой данных
4. **Flask** - веб-фреймворк для веб-интерфейса
5. **OpenAI API** - для интеграции с GPT-3.5
6. **Pandas** - для обработки данных и работы с таблицами рецептов
7. **APScheduler** - для планирования периодических задач

## 5. Структура базы данных

Проект использует SQLAlchemy для определения следующих моделей данных:

1. **ClientProfile** - профили пользователей бота
   - id, telegram_id, username, first_name, last_name, is_active, created_at, last_interaction, interaction_count

2. **UserSession** - сессии взаимодействия пользователей с ботом
   - id, user_id, start_time, end_time, last_interaction, session_duration, source, last_command, is_completed

3. **UserInteraction** - действия пользователей в рамках сессии
   - id, user_id, session_id, timestamp, action_type, action_data, response_time, success

4. **UserConversation** - история переписки пользователя с GPT
   - id, user_id, timestamp, messages (JSON-формат)

5. **RecipeRating** - оценки рецептов
   - id, user_id, recipe_type, recipe_name, rating, timestamp

6. **DailyHealthCheck** - ежедневные проверки настроения и самочувствия
   - id, user_id, mood, timestamp

7. **BroadcastMessage** - сообщения для массовой рассылки
   - id, admin_id, message, scheduled_time, sent, created_at, sent_at

8. **UserSurveyStatus** - статус прохождения анкетирования
   - id, user_id, is_completed, completed_at, last_reminder_at, created_at

## 6. Уникальные особенности проекта

1. **Интеграция с AI (GPT-3.5)** для предоставления персонализированных ответов
2. **Система отслеживания здоровья** через ежедневные опросы
3. **Обширная база рецептов**, подходящих для людей с синдромом Жильбера
4. **Веб-интерфейс** для анкетирования и сбора данных
5. **Автоматическое развертывание** через GitHub webhook
6. **Расширенная система логирования** для отслеживания взаимодействий
7. **Дизайн на основе состояний** для управления диалогами
8. **Административный интерфейс** для мониторинга и управления

## 7. Сценарии использования

1. **Новый пользователь**:
   - Нажимает `/start`
   - Получает приветствие и меню с основными возможностями
   - Может задать вопрос или выбрать одну из функций

2. **Задача вопроса**:
   - Пользователь задает вопрос о синдроме Жильбера
   - Бот анализирует вопрос через GPT-3.5
   - Предоставляет ответ и сохраняет историю диалога

3. **Проверка продукта**:
   - Пользователь выбирает проверку продукта
   - Вводит название продукта
   - Получает информацию о безопасности употребления

4. **Поиск рецепта**:
   - Пользователь выбирает категорию рецептов
   - Просматривает доступные варианты
   - Получает подробную информацию и может оценить рецепт

5. **Ежедневный мониторинг**:
   - Бот отправляет ежедневный опрос
   - Пользователь выбирает эмодзи, отражающее его состояние
   - Данные сохраняются для отслеживания динамики

## 8. Рекомендации по дальнейшему развитию

1. **Расширение базы знаний** о синдроме Жильбера
2. **Интеграция с медицинскими API** для более точных рекомендаций
3. **Внедрение системы напоминаний** о приеме лекарств и контроле питания
4. **Разработка мобильного приложения** для более полного функционала
5. **Интеграция с фитнес-трекерами** для комплексного мониторинга здоровья
6. **Персонализированные диетические планы** на основе собранных данных
7. **Расширение административной панели** для анализа больших данных
8. **Добавление голосового интерфейса** для улучшения доступности

## 9. Структура проекта

```
/
├── assistant.py               # Основной файл Telegram-бота
├── flask_app.py               # Веб-сервер на Flask
├── main.py                    # Консольный интерфейс для тестирования
├── database/                  # База данных
│   ├── models.py              # Определение моделей данных
│   ├── database.py            # Настройка соединения с БД
│   └── crud.py                # Операции с данными
├── handlers/                  # Обработчики команд бота
│   ├── menu.py                # Главное меню
│   ├── gpt.py                 # Обработка запросов через GPT
│   ├── product.py             # Проверка продуктов
│   ├── recipes.py             # Работа с рецептами
│   ├── survey.py              # Анкетирование
│   ├── stats.py               # Статистика
│   ├── admin.py               # Административные функции
│   └── broadcast.py           # Массовые рассылки
├── meals/                     # Модули для работы с питанием
│   ├── breakfast.py           # Завтраки
│   ├── lunch.py               # Обеды
│   ├── poldnik.py             # Полдники
│   └── drinks.py              # Напитки
├── utils/                     # Вспомогательные модули
│   ├── config.py              # Конфигурация
│   ├── gpt_35.py              # Интеграция с GPT-3.5
│   ├── states.py              # Определение состояний бота
│   └── data_operation.py      # Операции с данными
├── mini_app/                  # Telegram Mini App интерфейс
├── templates/                 # Шаблоны для веб-интерфейса
└── Data/                      # Файлы данных (CSV, Excel)
``` 